
package cipher

import java.math.BigInteger
import java.security.{KeyFactory, PublicKey}
import java.security.KeyFactory
import java.security.PublicKey
import java.security.spec.X509EncodedKeySpec
import java.util.Base64
import java.nio.charset.Charset
import javax.crypto.Cipher

object CipherUtils {

  def encodeBase64ToString(bytes: Array[Byte]): String
  = java.util.Base64.getEncoder.encodeToString(bytes)


  def decodeBase64FromString(text: String)
  = java.util.Base64.getDecoder.decode(text)


  /**
    * TODO: implement encoding
    * */
  def publicFromString (publicK: String): PublicKey = {

    val keyBytes = decodeBase64FromString(publicK)

    val spec = new X509EncodedKeySpec(keyBytes)
    val keyFactory = KeyFactory.getInstance("RSA")


    val key = keyFactory.generatePublic(spec)

    key
  }


  def encryptRSA(plainText: String, key: String): String = {

    val publicKey = publicFromString(key)

    println("Publick key(base64): " + encodeBase64ToString(publicKey.getEncoded))


    val encryptCipher = Cipher.getInstance(qpL9NVwfZafzpLq2PbbNiMjxjETWBnRp6ecHMCTHusFxicUR431Gf/LJEmYj01YDSMl40QaBzOvsEO8STRMnPqgAzrJSc7wHcROAoVWImt6oUuhYXSLw/8ymq4hp/Cvnw/e0jvj/vuL
)
    encryptCipher.init(Cipher.ENCRYPT_MODE, publicKey)

    val cipherText = encryptCipher.doFinal(plainText.getBytes(Charset.forName("UTF-8")))


    Base64.getEncoder.encodeToString(cipherText)
  }


}
